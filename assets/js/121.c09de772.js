(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{414:function(t,e,a){"use strict";a.r(e);var r=a(4),s=Object(r.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("经过五章的学习，我们终于回到了"),e("code",[t._v("React")]),t._v("应用的起点。")]),t._v(" "),e("p",[t._v("这一节我们完整的走通"),e("code",[t._v("ReactDOM.render")]),t._v("完成页面渲染的整个流程。")]),t._v(" "),e("h2",{attrs:{id:"创建fiber"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建fiber"}},[t._v("#")]),t._v(" 创建fiber")]),t._v(" "),e("p",[t._v("从"),e("RouterLink",{attrs:{to:"/source-code/process/doubleBuffer.html#mount时"}},[t._v("双缓存机制一节")]),t._v("我们知道，首次执行"),e("code",[t._v("ReactDOM.render")]),t._v("会创建"),e("code",[t._v("fiberRootNode")]),t._v("和"),e("code",[t._v("rootFiber")]),t._v("。其中"),e("code",[t._v("fiberRootNode")]),t._v("是整个应用的根节点，"),e("code",[t._v("rootFiber")]),t._v("是要渲染组件所在组件树的"),e("code",[t._v("根节点")]),t._v("。")],1),t._v(" "),e("p",[t._v("这一步发生在调用"),e("code",[t._v("ReactDOM.render")]),t._v("后进入的"),e("code",[t._v("legacyRenderSubtreeIntoContainer")]),t._v("方法中。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// container指ReactDOM.render的第二个参数（即应用挂载的DOM节点）")]),t._v("\nroot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" container"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_reactRootContainer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("legacyCreateRootFromDOMContainer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  container"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  forceHydrate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nfiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_internalRoot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("你可以从"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-dom/src/client/ReactDOMLegacy.js#L193",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到这一步的代码")])]),t._v(" "),e("p",[e("code",[t._v("legacyCreateRootFromDOMContainer")]),t._v("方法内部会调用"),e("code",[t._v("createFiberRoot")]),t._v("方法完成"),e("code",[t._v("fiberRootNode")]),t._v("和"),e("code",[t._v("rootFiber")]),t._v("的创建以及关联。并初始化"),e("code",[t._v("updateQueue")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiberRoot")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter"}},[e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("containerInfo")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tag")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" RootTag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hydrate")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hydrationCallbacks")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" SuspenseHydrationCallbacks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建fiberRootNode")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("root")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" FiberRoot "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FiberRootNode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("containerInfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建rootFiber")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" uninitializedFiber "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createHostRootFiber")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接rootFiber与fiberRootNode")]),t._v("\n  root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" uninitializedFiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  uninitializedFiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化updateQueue")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializeUpdateQueue")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uninitializedFiber"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" root"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("根据以上代码，现在我们可以在"),e("RouterLink",{attrs:{to:"/source-code/process/doubleBuffer.html#mount时"}},[t._v("双缓存机制一节")]),t._v("基础上补充上"),e("code",[t._v("rootFiber")]),t._v("到"),e("code",[t._v("fiberRootNode")]),t._v("的引用。")],1),t._v(" "),e("img",{attrs:{src:t.$withBase("/img/fiberroot.png"),alt:"fiberRoot"}}),t._v(" "),e("blockquote",[e("p",[t._v("你可以从"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberRoot.new.js#L97",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到这一步的代码")])]),t._v(" "),e("h2",{attrs:{id:"创建update"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建update"}},[t._v("#")]),t._v(" 创建update")]),t._v(" "),e("p",[t._v("我们已经做好了组件的初始化工作，接下来就等待创建"),e("code",[t._v("Update")]),t._v("来开启一次更新。")]),t._v(" "),e("p",[t._v("这一步发生在"),e("code",[t._v("updateContainer")]),t._v("方法中。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateContainer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token parameter"}},[e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("element")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReactNodeList"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("container")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" OpaqueRoot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parentComponent")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("React$Component"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("any"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" any"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("callback")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("Function"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Lane "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略与逻辑不相关代码")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建update")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" suspenseConfig"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update.payload为需要挂载在根节点的组件")]),t._v("\n  update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("payload "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("element"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// callback为ReactDOM.render的第三个参数 —— 回调函数")]),t._v("\n  callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将生成的update加入updateQueue")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueueUpdate")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调度更新")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduleUpdateOnFiber")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lane"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventTime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略与逻辑不相关代码")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("你可以从"),e("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberReconciler.new.js#L255",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到"),e("code",[t._v("updateContainer")]),t._v("的代码")])]),t._v(" "),e("p",[t._v("值得注意的是其中"),e("code",[t._v("update.payload = {element};")])]),t._v(" "),e("p",[t._v("这就是我们在"),e("RouterLink",{attrs:{to:"/source-code/实现-状态更新/update.html#update的结构"}},[t._v("Update一节")]),t._v("介绍的，对于"),e("code",[t._v("HostRoot")]),t._v("，"),e("code",[t._v("payload")]),t._v("为"),e("code",[t._v("ReactDOM.render")]),t._v("的第一个传参。")],1),t._v(" "),e("h2",{attrs:{id:"流程概览"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#流程概览"}},[t._v("#")]),t._v(" 流程概览")]),t._v(" "),e("p",[t._v("至此，"),e("code",[t._v("ReactDOM.render")]),t._v("的流程就和我们已知的流程连接上了。")]),t._v(" "),e("p",[t._v("整个流程如下：")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("创建fiberRootNode、rootFiber、updateQueue（"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("legacyCreateRootFromDOMContainer"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("）\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\n创建Update对象（"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("updateContainer"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("）\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\n从fiber到root（"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("markUpdateLaneFromFiberToRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("）\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\n调度更新（"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("ensureRootIsScheduled"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("）\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\nrender阶段（"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("performSyncWorkOnRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" 或 "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("performConcurrentWorkOnRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("）\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),t._v("\n\ncommit阶段（"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("commitRoot"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("）\n")])])]),e("h2",{attrs:{id:"react的其他入口函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#react的其他入口函数"}},[t._v("#")]),t._v(" React的其他入口函数")]),t._v(" "),e("p",[t._v("当前"),e("code",[t._v("React")]),t._v("共有三种模式：")]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("legacy")]),t._v("，这是当前"),e("code",[t._v("React")]),t._v("使用的方式。当前没有计划删除本模式，但是这个模式可能不支持一些新功能。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("blocking")]),t._v("，开启部分"),e("code",[t._v("concurrent")]),t._v("模式特性的中间模式。目前正在实验中。作为迁移到"),e("code",[t._v("concurrent")]),t._v("模式的第一个步骤。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("concurrent")]),t._v("，面向未来的开发模式。我们之前讲的"),e("code",[t._v("任务中断/任务优先级")]),t._v("都是针对"),e("code",[t._v("concurrent")]),t._v("模式。")])])]),t._v(" "),e("p",[t._v("你可以从下表看出各种模式对特性的支持：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th",[t._v("legacy 模式")]),t._v(" "),e("th",[t._v("blocking 模式")]),t._v(" "),e("th",[t._v("concurrent 模式")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/refs-and-the-dom.html#legacy-api-string-refs",target:"_blank",rel:"noopener noreferrer"}},[t._v("String Refs"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("🚫**")]),t._v(" "),e("td",[t._v("🚫**")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/legacy-context.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Legacy Context"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("🚫**")]),t._v(" "),e("td",[t._v("🚫**")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/strict-mode.html#warning-about-deprecated-finddomnode-usage",target:"_blank",rel:"noopener noreferrer"}},[t._v("findDOMNode"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("🚫**")]),t._v(" "),e("td",[t._v("🚫**")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-suspense.html#what-is-suspense-exactly",target:"_blank",rel:"noopener noreferrer"}},[t._v("Suspense"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#suspenselist",target:"_blank",rel:"noopener noreferrer"}},[t._v("SuspenseList"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[t._v("Suspense SSR + Hydration")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[t._v("Progressive Hydration")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[t._v("Selective Hydration")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[t._v("Cooperative Multitasking")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[t._v("Automatic batching of multiple setStates")]),t._v(" "),e("td",[t._v("🚫*")]),t._v(" "),e("td",[t._v("✅")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#splitting-high-and-low-priority-state",target:"_blank",rel:"noopener noreferrer"}},[t._v("Priority-based Rendering"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-intro.html#interruptible-rendering",target:"_blank",rel:"noopener noreferrer"}},[t._v("Interruptible Prerendering"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#transitions",target:"_blank",rel:"noopener noreferrer"}},[t._v("useTransition"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#deferring-a-value",target:"_blank",rel:"noopener noreferrer"}},[t._v("useDeferredValue"),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")])]),t._v(" "),e("tr",[e("td",[e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-patterns.html#suspense-reveal-train",target:"_blank",rel:"noopener noreferrer"}},[t._v('Suspense Reveal "Train"'),e("OutboundLink")],1)]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("🚫")]),t._v(" "),e("td",[t._v("✅")])])])]),t._v(" "),e("p",[t._v("*："),e("code",[t._v("legacy")]),t._v("模式在合成事件中有自动批处理的功能，但仅限于一个浏览器任务。非"),e("code",[t._v("React")]),t._v("事件想使用这个功能必须使用 "),e("code",[t._v("unstable_batchedUpdates")]),t._v("。在"),e("code",[t._v("blocking")]),t._v("模式和"),e("code",[t._v("concurrent")]),t._v("模式下，所有的"),e("code",[t._v("setState")]),t._v("在默认情况下都是批处理的。")]),t._v(" "),e("p",[t._v("**：会在开发中发出警告。")]),t._v(" "),e("p",[t._v("模式的变化影响整个应用的工作方式，所以无法只针对某个组件开启不同模式。")]),t._v(" "),e("p",[t._v("基于此原因，可以通过不同的"),e("code",[t._v("入口函数")]),t._v("开启不同模式：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("legacy")]),t._v(" -- "),e("code",[t._v("ReactDOM.render(<App />, rootNode)")])]),t._v(" "),e("li",[e("code",[t._v("blocking")]),t._v(" -- "),e("code",[t._v("ReactDOM.createBlockingRoot(rootNode).render(<App />)")])]),t._v(" "),e("li",[e("code",[t._v("concurrent")]),t._v(" -- "),e("code",[t._v("ReactDOM.createRoot(rootNode).render(<App />)")])])]),t._v(" "),e("blockquote",[e("p",[t._v("你可以在"),e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/concurrent-mode-adoption.html#why-so-many-modes",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到"),e("code",[t._v("React")]),t._v("团队解释为什么会有这么多模式")])]),t._v(" "),e("p",[t._v("虽然不同模式的"),e("code",[t._v("入口函数")]),t._v("不同，但是他们仅对"),e("code",[t._v("fiber.mode")]),t._v("变量产生影响，对我们在"),e("RouterLink",{attrs:{to:"/source-code/实现-状态更新/reactdom.html#流程概览"}},[t._v("流程概览")]),t._v("中描述的流程并无影响。")],1)])}),[],!1,null,null,null);e.default=s.exports}}]);