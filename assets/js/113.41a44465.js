(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{404:function(t,e,a){"use strict";a.r(e);var s=a(4),r=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("在上一节我们实现了一个极简的"),e("code",[t._v("useState")]),t._v("，了解了"),e("code",[t._v("Hooks")]),t._v("的运行原理。")]),t._v(" "),e("p",[t._v("本节我们讲解"),e("code",[t._v("Hooks")]),t._v("的数据结构，为后面介绍具体的"),e("code",[t._v("hook")]),t._v("打下基础。")]),t._v(" "),e("h2",{attrs:{id:"dispatcher"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dispatcher"}},[t._v("#")]),t._v(" dispatcher")]),t._v(" "),e("p",[t._v("在上一节的极简"),e("code",[t._v("useState")]),t._v("实现中，使用"),e("code",[t._v("isMount")]),t._v("变量区分"),e("code",[t._v("mount")]),t._v("与"),e("code",[t._v("update")]),t._v("。")]),t._v(" "),e("p",[t._v("在真实的"),e("code",[t._v("Hooks")]),t._v("中，组件"),e("code",[t._v("mount")]),t._v("时的"),e("code",[t._v("hook")]),t._v("与"),e("code",[t._v("update")]),t._v("时的"),e("code",[t._v("hook")]),t._v("来源于不同的对象，这类对象在源码中被称为"),e("code",[t._v("dispatcher")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mount时的Dispatcher")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("HooksDispatcherOnMount")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dispatcher "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useCallback")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountCallback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useContext")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" readContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useEffect")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useImperativeHandle")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountImperativeHandle"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useLayoutEffect")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountLayoutEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useMemo")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountMemo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useReducer")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountReducer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useRef")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountRef"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useState")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mountState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update时的Dispatcher")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("HooksDispatcherOnUpdate")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dispatcher "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useCallback")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateCallback"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useContext")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" readContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useEffect")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useImperativeHandle")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateImperativeHandle"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useLayoutEffect")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateLayoutEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useMemo")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateMemo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useReducer")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateReducer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useRef")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateRef"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useState")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" updateState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("可见，"),e("code",[t._v("mount")]),t._v("时调用的"),e("code",[t._v("hook")]),t._v("和"),e("code",[t._v("update")]),t._v("时调用的"),e("code",[t._v("hook")]),t._v("其实是两个不同的函数。")]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("FunctionComponent")]),t._v(" "),e("code",[t._v("render")]),t._v("前，会根据"),e("code",[t._v("FunctionComponent")]),t._v("对应"),e("code",[t._v("fiber")]),t._v("的以下条件区分"),e("code",[t._v("mount")]),t._v("与"),e("code",[t._v("update")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("current "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" current"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memoizedState "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n")])])]),e("p",[t._v("并将不同情况对应的"),e("code",[t._v("dispatcher")]),t._v("赋值给全局变量"),e("code",[t._v("ReactCurrentDispatcher")]),t._v("的"),e("code",[t._v("current")]),t._v("属性。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("ReactCurrentDispatcher"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n      current "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" current"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memoizedState "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" HooksDispatcherOnMount\n        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" HooksDispatcherOnUpdate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n")])])]),t._v(" "),e("blockquote",[e("p",[t._v("你可以在"),e("a",{attrs:{href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L409",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到这行代码")])]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("FunctionComponent")]),t._v(" "),e("code",[t._v("render")]),t._v("时，会从"),e("code",[t._v("ReactCurrentDispatcher.current")]),t._v("（即当前"),e("code",[t._v("dispatcher")]),t._v("）中寻找需要的"),e("code",[t._v("hook")]),t._v("。")]),t._v(" "),e("p",[t._v("换言之，不同的调用栈上下文为"),e("code",[t._v("ReactCurrentDispatcher.current")]),t._v("赋值不同的"),e("code",[t._v("dispatcher")]),t._v("，则"),e("code",[t._v("FunctionComponent")]),t._v(" "),e("code",[t._v("render")]),t._v("时调用的"),e("code",[t._v("hook")]),t._v("也是不同的函数。")]),t._v(" "),e("blockquote",[e("p",[t._v("除了这两个"),e("code",[t._v("dispatcher")]),t._v("，你可以在"),e("a",{attrs:{href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L1775",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到其他"),e("code",[t._v("dispatcher")]),t._v("定义")])]),t._v(" "),e("h2",{attrs:{id:"一个dispatcher使用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一个dispatcher使用场景"}},[t._v("#")]),t._v(" 一个dispatcher使用场景")]),t._v(" "),e("p",[t._v("当错误的书写了嵌套形式的"),e("code",[t._v("hook")]),t._v("，如：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("此时"),e("code",[t._v("ReactCurrentDispatcher.current")]),t._v("已经指向"),e("code",[t._v("ContextOnlyDispatcher")]),t._v("，所以调用"),e("code",[t._v("useState")]),t._v("实际会调用"),e("code",[t._v("throwInvalidHookError")]),t._v("，直接抛出异常。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ContextOnlyDispatcher")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dispatcher "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useCallback")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" throwInvalidHookError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useContext")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" throwInvalidHookError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useEffect")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" throwInvalidHookError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useImperativeHandle")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" throwInvalidHookError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("useLayoutEffect")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" throwInvalidHookError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("你可以在"),e("a",{attrs:{href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L458",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到这段逻辑")])]),t._v(" "),e("h2",{attrs:{id:"hook的数据结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hook的数据结构"}},[t._v("#")]),t._v(" Hook的数据结构")]),t._v(" "),e("p",[t._v("接下来我们学习"),e("code",[t._v("hook")]),t._v("的数据结构。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hook")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Hook "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("memoizedState")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("baseState")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("baseQueue")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("queue")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("next")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("blockquote",[e("p",[t._v("你可以在"),e("a",{attrs:{href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L546",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到创建"),e("code",[t._v("hook")]),t._v("的逻辑")])]),t._v(" "),e("p",[t._v("其中除"),e("code",[t._v("memoizedState")]),t._v("以外字段的意义与上一章介绍的"),e("RouterLink",{attrs:{to:"/source-code/state/update.html#updatequeue"}},[t._v("updateQueue")]),t._v("类似。")],1),t._v(" "),e("h2",{attrs:{id:"memoizedstate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#memoizedstate"}},[t._v("#")]),t._v(" memoizedState")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[e("code",[t._v("hook")]),t._v("与"),e("code",[t._v("FunctionComponent fiber")]),t._v("都存在"),e("code",[t._v("memoizedState")]),t._v("属性，不要混淆他们的概念。")]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("fiber.memoizedState")]),t._v("："),e("code",[t._v("FunctionComponent")]),t._v("对应"),e("code",[t._v("fiber")]),t._v("保存的"),e("code",[t._v("Hooks")]),t._v("链表。")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("hook.memoizedState")]),t._v("："),e("code",[t._v("Hooks")]),t._v("链表中保存的单一"),e("code",[t._v("hook")]),t._v("对应的数据。")])])])]),t._v(" "),e("p",[t._v("不同类型"),e("code",[t._v("hook")]),t._v("的"),e("code",[t._v("memoizedState")]),t._v("保存不同类型数据，具体如下：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("useState：对于"),e("code",[t._v("const [state, updateState] = useState(initialState)")]),t._v("，"),e("code",[t._v("memoizedState")]),t._v("保存"),e("code",[t._v("state")]),t._v("的值")])]),t._v(" "),e("li",[e("p",[t._v("useReducer：对于"),e("code",[t._v("const [state, dispatch] = useReducer(reducer, {});")]),t._v("，"),e("code",[t._v("memoizedState")]),t._v("保存"),e("code",[t._v("state")]),t._v("的值")])]),t._v(" "),e("li",[e("p",[t._v("useEffect："),e("code",[t._v("memoizedState")]),t._v("保存包含"),e("code",[t._v("useEffect回调函数")]),t._v("、"),e("code",[t._v("依赖项")]),t._v("等的链表数据结构"),e("code",[t._v("effect")]),t._v("，你可以在"),e("a",{attrs:{href:"https://github.com/acdlite/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberHooks.new.js#L1181",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),e("OutboundLink")],1),t._v("看到"),e("code",[t._v("effect")]),t._v("的创建过程。"),e("code",[t._v("effect")]),t._v("链表同时会保存在"),e("code",[t._v("fiber.updateQueue")]),t._v("中")])]),t._v(" "),e("li",[e("p",[t._v("useRef：对于"),e("code",[t._v("useRef(1)")]),t._v("，"),e("code",[t._v("memoizedState")]),t._v("保存"),e("code",[t._v("{current: 1}")])])]),t._v(" "),e("li",[e("p",[t._v("useMemo：对于"),e("code",[t._v("useMemo(callback, [depA])")]),t._v("，"),e("code",[t._v("memoizedState")]),t._v("保存"),e("code",[t._v("[callback(), depA]")])])]),t._v(" "),e("li",[e("p",[t._v("useCallback：对于"),e("code",[t._v("useCallback(callback, [depA])")]),t._v("，"),e("code",[t._v("memoizedState")]),t._v("保存"),e("code",[t._v("[callback, depA]")]),t._v("。与"),e("code",[t._v("useMemo")]),t._v("的区别是，"),e("code",[t._v("useCallback")]),t._v("保存的是"),e("code",[t._v("callback")]),t._v("函数本身，而"),e("code",[t._v("useMemo")]),t._v("保存的是"),e("code",[t._v("callback")]),t._v("函数的执行结果")])])]),t._v(" "),e("p",[t._v("有些"),e("code",[t._v("hook")]),t._v("是没有"),e("code",[t._v("memoizedState")]),t._v("的，比如：")]),t._v(" "),e("ul",[e("li",[t._v("useContext")])])])}),[],!1,null,null,null);e.default=r.exports}}]);